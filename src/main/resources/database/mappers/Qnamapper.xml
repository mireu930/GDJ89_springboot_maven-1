<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.mireu.app.board.qna.QnaDAO">

	<select id="getList" resultType="QnaVO">
		SELECT * FROM QNA_TBL
		ORDER BY BOARD_REF DESC, BOARD_STEP ASC
	</select>
	
	<select id="getDetail" resultType="QnaVO" parameterType="QnaVO">
		SELECT * FROM QNA_TBL WHERE BOARD_NUM = #{boardNum}
	</select>
	
	<insert id="add" parameterType="QnaVO" useGeneratedKeys="true" keyProperty="boardNum">
	<!-- insert가끝난후 만들어줌 -->
		INSERT INTO QNA_TBL
		VALUES (0, #{boardTitle}, #{boardContents},now() ,0,#{boardNum},0,0,#{userName})
	</insert>
	
	<insert id="reply" parameterType="QnaVO">
		INSERT INTO QNA_TBL
		VALUES (0, #{boardTitle},#{boardContents},now(),0,#{boardRef},#{boardStep},#{boardDepth},#{userName})
	</insert>
	
	<update id="refUpdate" parameterType="QnaVO">
		UPDATE QNA_TBL SET BOARD_REF = #{boardNum} WHERE BOARD_NUM = #{boardNum}
	</update>
	
	<update id="updateStep" parameterType="QnaVO">
		UPDATE QNA_TBL SET BOARD_STEP=BOARD_STEP+1 WHERE BOARD_REF=#{boardRef} AND BOARD_STEP > #{boardStep}
	</update>
</mapper>